<?xml version="1.0" encoding="utf-8" ?>
<controls:ContentPage
    x:Class="Plugin.Maui.OCR.Sample.MainPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:controls="clr-namespace:Microsoft.Maui.Controls;assembly=Microsoft.Maui.Controls"
    xmlns:converters="clr-namespace:CommunityToolkit.Maui.Converters;assembly=CommunityToolkit.Maui"
    xmlns:xaml="clr-namespace:Microsoft.Maui.Controls.Xaml;assembly=Microsoft.Maui.Controls.Xaml"
    Title="OCR Plugin"
    BackgroundColor="{xaml:AppThemeBinding Light={xaml:StaticResource White},
                                           Dark={xaml:StaticResource Black}}">

    <controls:Grid
        Padding="16"
        RowDefinitions="Auto,*,Auto"
        RowSpacing="16">

        <!--  Header Section  -->
        <controls:VerticalStackLayout controls:Grid.Row="0" Spacing="12">
            <controls:HorizontalStackLayout HorizontalOptions="Center" Spacing="12">
                <controls:Label
                    FontAttributes="Bold"
                    Text="Enhanced OCR Mode"
                    VerticalOptions="Center" />
                <controls:Switch
                    x:Name="TryHardSwitch"
                    IsToggled="False"
                    OnColor="#6750A4"
                    ThumbColor="White" />
            </controls:HorizontalStackLayout>

            <!--  Source Selection Tab Control  -->
            <Border
                Padding="0"
                Background="#00000000"
                Stroke="#E0E0E0"
                StrokeShape="RoundRectangle 8">
                <controls:Grid ColumnDefinitions="*,*" RowDefinitions="Auto,Auto">
                    <!--  Tab Headers  -->
                    <controls:Button
                        x:Name="CameraTabBtn"
                        controls:Grid.Column="0"
                        BackgroundColor="#6750A4"
                        Clicked="CameraTabBtn_Clicked"
                        CornerRadius="0"
                        Text="Camera"
                        TextColor="White" />
                    <controls:Button
                        x:Name="FileTabBtn"
                        controls:Grid.Column="1"
                        BackgroundColor="#E0E0E0"
                        Clicked="FileTabBtn_Clicked"
                        CornerRadius="0"
                        Text="File"
                        TextColor="#6750A4" />

                    <!--  Tab Content  -->
                    <controls:Grid
                        x:Name="CameraOptions"
                        Padding="16"
                        controls:Grid.ColumnSpan="2"
                        controls:Grid.Row="1"
                        ColumnDefinitions="*,*">
                        <controls:Button
                            x:Name="OpenFromCameraBtn"
                            Margin="4,0"
                            controls:Grid.Column="0"
                            Clicked="OpenFromCameraBtn_Clicked"
                            Text="No Event">
                            <controls:Button.ImageSource>
                                <controls:FontImageSource
                                    FontFamily="Icon"
                                    Glyph="&#xe3af;"
                                    Color="White" />
                            </controls:Button.ImageSource>
                        </controls:Button>
                        <controls:Button
                            x:Name="OpenFromCameraUseEventBtn"
                            Margin="4,0"
                            controls:Grid.Column="1"
                            Clicked="OpenFromCameraUseEventBtn_Clicked"
                            Text="Use Event">
                            <controls:Button.ImageSource>
                                <controls:FontImageSource
                                    FontFamily="Icon"
                                    Glyph="&#xe3af;"
                                    Color="White" />
                            </controls:Button.ImageSource>
                        </controls:Button>
                    </controls:Grid>

                    <controls:Grid
                        x:Name="FileOptions"
                        Padding="16"
                        controls:Grid.ColumnSpan="2"
                        controls:Grid.Row="1"
                        ColumnDefinitions="*,*"
                        IsVisible="False">
                        <controls:Button
                            x:Name="OpenFromFileBtn"
                            Margin="4,0"
                            controls:Grid.Column="0"
                            Clicked="OpenFromFileBtn_Clicked"
                            Text="No Event">
                            <controls:Button.ImageSource>
                                <controls:FontImageSource
                                    FontFamily="Icon"
                                    Glyph="&#xe24d;"
                                    Color="White" />
                            </controls:Button.ImageSource>
                        </controls:Button>
                        <controls:Button
                            x:Name="OpenFromFileUseEventBtn"
                            Margin="4,0"
                            controls:Grid.Column="1"
                            Clicked="OpenFromFileUseEventBtn_Clicked"
                            Text="Use Event">
                            <controls:Button.ImageSource>
                                <controls:FontImageSource
                                    FontFamily="Icon"
                                    Glyph="&#xe24d;"
                                    Color="White" />
                            </controls:Button.ImageSource>
                        </controls:Button>
                    </controls:Grid>
                </controls:Grid>
            </Border>
        </controls:VerticalStackLayout>

        <!--  Content Section - Expandable Panels  -->
        <controls:Grid
            x:Name="ContentPanels"
            controls:Grid.Row="1"
            ColumnDefinitions="*,*"
            ColumnSpacing="16">

            <!--  OCR Results Panel  -->
            <Border
                x:Name="ResultsPanel"
                Margin="0"
                Padding="0"
                Background="#FFFFFFFF"
                Shadow="4"
                Stroke="#E0E0E0"
                StrokeShape="RoundRectangle 8">
                <controls:Grid RowDefinitions="Auto,*">
                    <!--  Header with Copy Button  -->
                    <controls:Grid ColumnDefinitions="*,Auto,Auto">
                        <controls:Label
                            Padding="12,8"
                            controls:Grid.Column="0"
                            BackgroundColor="#F5F5F5"
                            FontAttributes="Bold"
                            FontSize="14"
                            Text="OCR Results"
                            VerticalOptions="Center" />

                        <!--  Copy Button in Header  -->
                        <controls:Button
                            x:Name="CopyBtn"
                            Margin="0"
                            Padding="0"
                            controls:Grid.Column="1"
                            BackgroundColor="Transparent"
                            Clicked="CopyBtn_Clicked"
                            CornerRadius="20"
                            HeightRequest="40"
                            IsVisible="{controls:Binding Source={xaml:Reference ResultLbl},
                                                         Path=Text,
                                                         Converter={converters:IsNotEqualConverter},
                                                         ConverterParameter='Waiting for results ...'}"
                            WidthRequest="40">
                            <controls:Button.ImageSource>
                                <controls:FontImageSource
                                    FontFamily="Icon"
                                    Glyph="&#xe14d;"
                                    Color="#6750A4" />
                            </controls:Button.ImageSource>
                        </controls:Button>

                        <!--  Expand Button  -->
                        <controls:Button
                            x:Name="ExpandResultsBtn"
                            Margin="0"
                            Padding="0"
                            controls:Grid.Column="2"
                            BackgroundColor="Transparent"
                            Clicked="ExpandResultsBtn_Clicked"
                            CornerRadius="20"
                            HeightRequest="40"
                            WidthRequest="40">
                            <controls:Button.ImageSource>
                                <controls:FontImageSource
                                    FontFamily="Icon"
                                    Glyph="&#xe5d0;"
                                    Color="#6750A4" />
                            </controls:Button.ImageSource>
                        </controls:Button>
                    </controls:Grid>

                    <!--  Scrollable Content  -->
                    <controls:ScrollView controls:Grid.Row="1">
                        <controls:VerticalStackLayout Padding="12">
                            <controls:Label
                                x:Name="ResultLbl"
                                FontFamily="Monospace"
                                Text="Waiting for results ..."
                                TextType="Html" />
                        </controls:VerticalStackLayout>
                    </controls:ScrollView>
                </controls:Grid>

                <!--  Tap Recognizer for Expanding  -->
                <Border.GestureRecognizers>
                    <controls:TapGestureRecognizer Tapped="ResultsPanel_Tapped" />
                </Border.GestureRecognizers>
            </Border>

            <!--  Image Preview Panel  -->
            <Border
                x:Name="PreviewPanel"
                Margin="0"
                Padding="0"
                Background="#FFFFFFFF"
                Shadow="4"
                Stroke="#E0E0E0"
                StrokeShape="RoundRectangle 8">
                <controls:Grid RowDefinitions="Auto,*">
                    <!--  Header with Expand Button  -->
                    <controls:Grid ColumnDefinitions="*,Auto">
                        <controls:Label
                            Padding="12,8"
                            controls:Grid.Column="0"
                            BackgroundColor="#F5F5F5"
                            FontAttributes="Bold"
                            FontSize="14"
                            Text="Image Preview"
                            VerticalOptions="Center" />

                        <!--  Expand Button  -->
                        <controls:Button
                            x:Name="ExpandPreviewBtn"
                            Margin="0"
                            Padding="0"
                            controls:Grid.Column="1"
                            BackgroundColor="Transparent"
                            Clicked="ExpandPreviewBtn_Clicked"
                            CornerRadius="20"
                            HeightRequest="40"
                            WidthRequest="40">
                            <controls:Button.ImageSource>
                                <controls:FontImageSource
                                    FontFamily="Icon"
                                    Glyph="&#xe5d0;"
                                    Color="#6750A4" />
                            </controls:Button.ImageSource>
                        </controls:Button>
                    </controls:Grid>

                    <!--  Image Content  -->
                    <controls:Grid controls:Grid.Row="1">
                        <controls:Image
                            x:Name="CapturedImage"
                            Margin="8"
                            Aspect="AspectFit" />

                        <!--  Placeholder when no image  -->
                        <controls:VerticalStackLayout
                            x:Name="NoImagePlaceholder"
                            HorizontalOptions="Center"
                            IsVisible="True"
                            VerticalOptions="Center">
                            <controls:Label
                                FontFamily="Icon"
                                FontSize="48"
                                HorizontalOptions="Center"
                                Text="&#xe410;"
                                TextColor="#BDBDBD" />
                            <controls:Label
                                Margin="0,8,0,0"
                                HorizontalOptions="Center"
                                Text="No image selected"
                                TextColor="#757575" />
                        </controls:VerticalStackLayout>
                    </controls:Grid>
                </controls:Grid>

                <!--  Tap Recognizer for Expanding  -->
                <Border.GestureRecognizers>
                    <controls:TapGestureRecognizer Tapped="PreviewPanel_Tapped" />
                </Border.GestureRecognizers>
            </Border>
        </controls:Grid>

        <!--  Footer Controls  -->
        <controls:Grid
            controls:Grid.Row="2"
            ColumnDefinitions="*,*"
            ColumnSpacing="16">
            <controls:Button
                x:Name="EnhanceImageBtn"
                controls:Grid.Column="0"
                Clicked="EnhanceImageBtn_Clicked"
                IsEnabled="{controls:Binding Source={xaml:Reference CapturedImage},
                                             Path=Source,
                                             Converter={converters:IsNotNullConverter}}"
                Text="Use OpenCV">
                <controls:Button.ImageSource>
                    <controls:FontImageSource
                        FontFamily="Icon"
                        Glyph="&#xe3a2;"
                        Color="White" />
                </controls:Button.ImageSource>
            </controls:Button>
            <controls:Button
                x:Name="ClearBtn"
                controls:Grid.Column="1"
                Clicked="ClearBtn_Clicked"
                IsEnabled="{controls:Binding Source={xaml:Reference CapturedImage},
                                             Path=Source,
                                             Converter={converters:IsNotNullConverter}}"
                Text="Clear All">
                <controls:Button.ImageSource>
                    <controls:FontImageSource
                        FontFamily="Icon"
                        Glyph="&#xe14c;"
                        Color="White" />
                </controls:Button.ImageSource>
            </controls:Button>
        </controls:Grid>
        <controls:Grid
            x:Name="LoadingOverlay"
            controls:Grid.Row="0"
            controls:Grid.RowSpan="3"
            BackgroundColor="#80000000"
            InputTransparent="False"
            IsVisible="false">
            <controls:VerticalStackLayout
                HorizontalOptions="Center"
                Spacing="12"
                VerticalOptions="Center">
                <controls:ActivityIndicator
                    HeightRequest="50"
                    IsRunning="True"
                    WidthRequest="50"
                    Color="#6750A4" />
                <controls:Label
                    x:Name="ProcessingLabel"
                    FontAttributes="Bold"
                    HorizontalOptions="Center"
                    Text="Processing..."
                    TextColor="White" />
            </controls:VerticalStackLayout>
        </controls:Grid>
    </controls:Grid>
</controls:ContentPage>
